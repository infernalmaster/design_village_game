(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.default=createCombain;var degToRad=Math.PI/180;var obstacles=[[865,305],[1112,442],[582,543],[606,589],[1260,669],[1318,695]];function createCombain(size){var el=document.getElementById("combain");var elShadow=document.getElementById("combainShadow");var i=0;var combain={w:154,h:130,x:0,y:0,angle:0,speed:2,alngleSpeed:2,update:function update(controls){var direction=controls.forward?1:-1;var angleDirection=controls.left?-1:controls.right?1:0;var nextX=combain.x+Math.cos(combain.angle*degToRad)*combain.speed*direction;var nextY=combain.y+Math.sin(combain.angle*degToRad)*combain.speed*direction;var nextAngle=combain.angle+angleDirection*combain.alngleSpeed*direction;var isColided=false;var aRad=-degToRad*nextAngle;var cosA=Math.cos(aRad);var sinA=Math.sin(aRad);obstacles.forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),x=_ref2[0],y=_ref2[1];var x1=x;var y1=y+(size.h-1080)/2;var x2=x1-nextX;var y2=y1-nextY;var x3=x2*cosA-y2*sinA;var y3=x2*sinA+y2*cosA;if(27<x3&&x3<77&&-65<y3&&y3<65||-77<x3&&x3<27&&-35<y3&&y3<35){isColided=true}});if(!isColided){combain.x=nextX;combain.y=nextY;combain.angle=nextAngle}},reset:function reset(){combain.x=100;combain.y=size.h-100;combain.angle=-90},draw:function draw(){changePosition(elShadow,combain.x-10,combain.y+10,combain.angle);changePosition(el,combain.x,combain.y,combain.angle);var p=void 0;if(i<5){p="0"}else if(i<10){p="-154px"}else{p="-308px"}i+=1;if(i===15){i=0}el.style.backgroundPositionX=p;return i}};return combain}function changePosition(el,x,y,angle){el.style.transform="translate("+x+"px, "+y+"px) rotate("+angle+"deg)"}},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=createControls;var keycode=require("keycode");var controls={forward:false,backward:false,left:false,right:false};var btnMapping=[{keys:["up","w"],control:"forward"},{keys:["down","s"],control:"backward"},{keys:["left","a"],control:"left"},{keys:["right","d"],control:"right"}];function onKeyDown(ev){var key=keycode(ev);btnMapping.forEach(function(_ref){var keys=_ref.keys,control=_ref.control;if(keys.indexOf(key)!==-1){controls[control]=true}})}function onKeyUp(ev){var key=keycode(ev);btnMapping.forEach(function(_ref2){var keys=_ref2.keys,control=_ref2.control;if(keys.indexOf(key)!==-1){controls[control]=false}})}function createControls(){window.addEventListener("keydown",onKeyDown);window.addEventListener("keyup",onKeyUp);return controls}},{keycode:8}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=createField;var degToRad=Math.PI/180;function createField(size,filedImage){var canvas=document.getElementById("trak");canvas.width=size.w;canvas.height=size.h;var ctx=canvas.getContext("2d");var area={};area.x=(size.w-filedImage.width)/2;area.y=(size.h-filedImage.height)/2;area.w=filedImage.width;area.h=filedImage.height;function reset(){ctx.drawImage(filedImage,area.x,area.y)}function cut(combain){ctx.translate(combain.x,combain.y);ctx.rotate(combain.angle*degToRad);ctx.translate(combain.w/2-40,-combain.h/2);ctx.clearRect(0,0,30,combain.h);ctx.setTransform(1,0,0,1,0,0)}function getArea(){var s=0;var data=ctx.getImageData(area.x,area.y,area.w,area.h).data;var dataSize=area.w*area.h*4;for(var i=1;i<dataSize;i+=4){if(data[i]){s++}}return s}return{cut:cut,getArea:getArea,reset:reset}}},{}],4:[function(require,module,exports){"use strict";var _controls=require("./controls");var _controls2=_interopRequireDefault(_controls);var _field=require("./field");var _field2=_interopRequireDefault(_field);var _combain=require("./combain");var _combain2=_interopRequireDefault(_combain);var _timer=require("./timer");var _timer2=_interopRequireDefault(_timer);var _score=require("./score");var _score2=_interopRequireDefault(_score);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function initGameDOM(){var gameEl=document.getElementById("game");var ww=gameEl.offsetWidth;var wh=gameEl.offsetHeight;var size={w:1920,h:1920*wh/ww};var scale=gameEl.offsetWidth/size.w;gameEl.style.transform="scale("+scale+") translate(-"+(size.w-ww)/2/scale+"px, -"+(size.h-wh)/2/scale+"px)";gameEl.style.width=size.w+"px";gameEl.style.height=size.h+"px";return size}var size=initGameDOM();var instruction=document.querySelector(".js-instruction-popup");instruction.onclick=function(){return instruction.style.display="none"};var filedImage=new Image;filedImage.onload=function(){var grass=(0,_field2.default)(size,filedImage);var controls=(0,_controls2.default)();var combain=(0,_combain2.default)(size);var timer=(0,_timer2.default)();var score=(0,_score2.default)();var resultPopup=document.querySelector(".js-result-popup");var shareBtn=document.querySelector(".js-share");var popupTimer=document.querySelector(".js-popup-timer");var isGameRunning=void 0;function gameEnd(){isGameRunning=false;resultPopup.style.display="block";var result=timer.getFormatedTimer();popupTimer.textContent=result;var msg="Мій результат "+result+" с";shareBtn.href="https://www.facebook.com/dialog/feed?\napp_id=145634995501895\n&display=popup\n&amp;description="+encodeURI(msg)+"\n&link=http%3A%2F%2Fpromo.designvillage.com.ua"}function reset(){resultPopup.style.display="none";isGameRunning=true;grass.reset();score.reset(grass.getArea(),gameEnd);combain.reset();timer.reset();draw(combain);score.update(grass.getArea());timer.nextTickAndDraw()}reset();Array.prototype.slice.call(document.querySelectorAll(".js-restart"),0).forEach(function(el){return el.onclick=reset});function draw(){var i=combain.draw();grass.cut(combain);if(i===7||i===14){setTimeout(function(){return score.update(grass.getArea())})}}function tick(){requestAnimationFrame(tick);if(isGameRunning){timer.nextTickAndDraw();if(controls.forward||controls.backward){timer.startIfNotStared();combain.update(controls);draw()}}}tick()};filedImage.src="/farm/field.png"},{"./combain":1,"./controls":2,"./field":3,"./score":5,"./timer":6}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=createScore;function createScore(){var scoreEl=document.getElementById("score");var initArea=void 0;var endCb=void 0;function reset(initArea_,endCb_){initArea=initArea_;endCb=endCb_}function update(area){var percents=(1-area/initArea)*100;if(percents>99.99){percents=100;endCb()}scoreEl.textContent=Math.floor(percents)+"%"}return{update:update,reset:reset}}},{}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=createTimer;function createTimer(){var el=document.getElementById("timer");var startTimestamp=void 0;var diff=void 0;function reset(){startTimestamp=0;diff=0}function startIfNotStared(){if(!startTimestamp){startTimestamp=(new Date).getTime()}}function nextTickAndDraw(){if(startTimestamp){diff=(new Date).getTime()-startTimestamp}el.textContent=getFormatedTimer()}function getFormatedTimer(){return formatTime(diff)}return{startIfNotStared:startIfNotStared,nextTickAndDraw:nextTickAndDraw,reset:reset,getFormatedTimer:getFormatedTimer}}function formatTime(miliseconds){var m=Math.floor(miliseconds/1e3%3600/60);var s=miliseconds/1e3%60;return(m<10?"0"+m:m)+":"+(s<10?"0"+s.toFixed(2):s.toFixed(2))}},{}],7:[function(require,module,exports){"use strict";require("./farm")},{"./farm":4}],8:[function(require,module,exports){exports=module.exports=function(searchInput){if(searchInput&&"object"===typeof searchInput){var hasKeyCode=searchInput.which||searchInput.keyCode||searchInput.charCode;if(hasKeyCode)searchInput=hasKeyCode}if("number"===typeof searchInput)return names[searchInput];var search=String(searchInput);var foundNamedKey=codes[search.toLowerCase()];if(foundNamedKey)return foundNamedKey;var foundNamedKey=aliases[search.toLowerCase()];if(foundNamedKey)return foundNamedKey;if(search.length===1)return search.charCodeAt(0);return undefined};var codes=exports.code=exports.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};var aliases=exports.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(i=97;i<123;i++)codes[String.fromCharCode(i)]=i-32;for(var i=48;i<58;i++)codes[i-48]=i;for(i=1;i<13;i++)codes["f"+i]=i+111;for(i=0;i<10;i++)codes["numpad "+i]=i+96;var names=exports.names=exports.title={};for(i in codes)names[codes[i]]=i;for(var alias in aliases){codes[alias]=aliases[alias]}},{}]},{},[7]);
